<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>


        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Charts in a TabView</title>
        <link href="css/anim.css" rel="stylesheet" type="text/css">
        <style type="text/css">
            /*margin and padding on body element
              can introduce errors in determining
              element position and are not recommended;
              we turn them off as a foundation for YUI
              CSS treatments. */
            body {
                margin:0;
                padding:0;
            }
        </style>

        <link rel="stylesheet" type="text/css" href="lib/yui2/build/fonts/fonts-min.css" />
        <link rel="stylesheet" type="text/css" href="lib/yui2/build/tabview/assets/skins/sam/tabview.css" />
        <script type="text/javascript" src="lib/yui2/build/yahoo-dom-event/yahoo-dom-event.js"></script>

        <script type="text/javascript" src="lib/yui2/build/json/json-min.js"></script>
        <script type="text/javascript" src="lib/yui2/build/element/element-min.js"></script>
        <script type="text/javascript" src="lib/yui2/build/datasource/datasource-min.js"></script>
        <script type="text/javascript" src="lib/yui2/build/swf/swf-min.js"></script>
        <script type="text/javascript" src="lib/yui2/build/charts/charts-min.js"></script>
        <script type="text/javascript" src="lib/yui2/build/tabview/tabview-min.js"></script>
        <link rel="stylesheet" type="text/css" href="lib/yui2/build/fonts/fonts-min.css" />
        <script type="text/javascript" src="lib/yui2/build/yahoo-dom-event/yahoo-dom-event.js"></script>
        <script type="text/javascript" src="lib/yui2/build/json/json-min.js"></script>
 
        <script type="text/javascript" src="lib/yui2/build/connection/connection-min.js"></script>
     
        <link type="text/css" rel="stylesheet" href="lib/yui/build/cssfonts/fonts-min.css" />
        <script type="text/javascript" src="lib/yui/build/yui/yui-min.js"></script>
        <!--begin custom header content for this example-->
        <style type="text/css">
            .chart
            {
                width: '100%';
                height: 350px;
                margin-bottom: 10px;
            }

            .chart_title
            {
                display: block;
                font-size: 1.2em;
                font-weight: bold;
                margin-bottom: 0.4em;

            }

            #tabContainer
            {
                width: '100%';
            }

        </style>

        <!--end custom header content for this example-->

    </head>

    <body class="yui-skin-sam">


        <div id="tabContainer"></div>
        <script  type="text/javascript">

            YUI({ filter: 'raw' }).use("io-base", "node","json-parse",function(Y) {


                //A function handler to use for successful requests:
                var handleSuccess = function(ioId, o){
                    Y.log("Chart initiated");
                    drawChart();

                }

                //A function handler to use for failed requests:
                var handleFailure = function(ioId, o){
                    Y.log("The failure handler was called.", "info", "chart");
                }

                //Subscribe our handlers to IO's global custom events:
                Y.on('io:success', handleSuccess);
                Y.on('io:failure', handleFailure);


                /* Configuration object for POST transaction */
                var cfg = {
                    method: "GET"
                };

                //The URL of the resource to which we're POSTing data:
                var sUrl = "Charts/initiate";

                //Handler to make our XHR request when the button is clicked:
                function makeRequest(){
                    var request = Y.io(sUrl, cfg);
                };

                // Make a request when the page loads
                Y.on("load", makeRequest);

                Y.log("Loading the chart", "info", "chart");
            }
        );
        </script>
        <script type="text/javascript">
            YUI().use('node-base', function (Y) {
                var pauseGraph=function(e){
                    alert(e.currentTarget.get("innerHTML"));
                    if(e.currentTarget.get("innerHTML")== 'Stop Animation'){
                        combinedChart.setStyle("animationEnabled",false);
                        e.currentTarget.set("innerHTML","Start Animation")
                    }
                    else{
                        combinedChart.setStyle("animationEnabled",true);
                        e.currentTarget.set("innerHTML","Stop Animation")
                    }
                }
           
                Y.on('click', pauseGraph,'#animation');
            });
        </script>

        <script type="text/javascript">
            var combinedChart;
            var drawChart=function (){
            	YAHOO.widget.Chart.SWFURL = "http://yui.yahooapis.com/2.9.0/build/charts/assets/charts.swf";
                var body="<table>";
                body+="<tr>";
                body+="<td style='color:#FF4848;font-weight:bold'> Show Query/Sec:</td>";
                body+="<td><input id='checkbutton1' type='checkbox' name='series1' value='1' checked='true' onclick='combinedChart.setSeriesStylesByIndex(0,{visibility:this.checked?\"visible\":\"hidden\"});'></td>";
                body+="</tr>";
                body+="<tr>";
                body+="<td style='color:#AE70ED;font-weight:bold'> Show Update/Sec:</td>";
                body+="<td><input id=\"checkbutton2\" type=\"checkbox\" name=\"series2\" value=\"2\" checked=\"true\" onclick='combinedChart.setSeriesStylesByIndex(1,{visibility:this.checked?\"visible\":\"hidden\"});'></td>";
                body+="</tr>";
                body+="<tr>";
                body+="<td style='color:#62D0FF;font-weight:bold'>Show Delete/Sec:</td>";
                body+="<td><input id=\"checkbutton3\" type=\"checkbox\" name=\"series3\" value=\"3\" checked=\"true\" onclick='combinedChart.setSeriesStylesByIndex(2,{visibility:this.checked?\"visible\":\"hidden\"});'></td>";
                body+="</tr>";
                body+="<tr>";
                body+="<td style='color:#2DC800;font-weight:bold'>Show Insert/Sec:</td>";
                body+="<td><input id=\"checkbutton4\" type=\"checkbox\" name=\"series4\" value=\"4\" checked=\"true\" onclick='combinedChart.setSeriesStylesByIndex(3,{visibility:this.checked?\"visible\":\"hidden\"});'></td>";
                body+="</tr>";
                body+="<tr>";
                body+="<td><button id='animation' class='button'>Stop Animation</button></td>";
                body+="</tr>";
                body+="</table>";

                //--- tabView

                //Create a TabView
                var tabView = new YAHOO.widget.TabView();

                //Add a tab for the Query
                tabView.addTab( new YAHOO.widget.Tab({
                    label: 'Combined View',
                    content: '<span class="chart_title">Combined View</span> <div class="chart" id="combinedChart"></div><center><span class="chart_title">Time Stamp</span></center>'+body,
                    active: true,
                    width:'100%'
                }));
                tabView.addTab( new YAHOO.widget.Tab({
                    label: 'Queries',
                    content: '<span class="chart_title">Queries/Second</span><div class="chart" id="queryChart"></div><center><span class="chart_title">Time Stamp</span></center>',
                    width:'100%'
                }));

                //	Add a tab for the Update
                tabView.addTab( new YAHOO.widget.Tab({
                    label: 'Updates',
                    content: '<span class="chart_title">Updates/Second</span><div class="chart" id="updateChart"></div><center><span class="chart_title">Time Stamp</span></center>',
                    width:'100%'
                }));

                //	Add a tab for the Delete
                tabView.addTab( new YAHOO.widget.Tab({
                    label: 'Deletes',
                    content: '<span class="chart_title">Deletes/Second</span><div class="chart" id="deleteChart"></div><center><span class="chart_title">Time Stamp</span></center>',
                    width:'100%'
                }));

                //	Add a tab for the Insert
                tabView.addTab( new YAHOO.widget.Tab({
                    label: 'Inserts',
                    content: '<span class="chart_title">Inserts/Second</span><div class="chart" id="insertChart"></div><center><span class="chart_title">Time Stamp</span></center>',
                    width:'100%'
                }));


                //Append TabView to its container div
                tabView.appendTo('tabContainer');

                //--- data
                var queryData = new YAHOO.util.DataSource( "Charts/query?" );
                //use POST so that IE doesn't cache the data
                queryData.connMethodPost = true;
                queryData.responseType = YAHOO.util.DataSource.TYPE_JSON;
                queryData.responseSchema =
                    {
                    resultsList: "Results",
                    fields: ["TimeStamp","QueryValue","UpdateValue","DeleteValue", "InsertValue"]
                };

                //
                //--- chart

                var pollingTime=1000;
                var seriesDef = [
                    {displayName:"Query", yField:"QueryValue", style:{color:0xFF4848}},
                    {displayName:"Update", yField:"UpdateValue", style:{color:0xAE70ED}},
                    {displayName:"Delete", yField:"DeleteValue", style:{color:0x62D0FF}},
                    {displayName:"Insert", yField:"InsertValue", style:{color:0x2DC800}},
                ];

                combinedChart = new YAHOO.widget.LineChart( "combinedChart", queryData,
                {
                    xField: "TimeStamp",
                    series: seriesDef,
                    //        	polling: pollingTime,
                    //only needed for flash player express install
                   // expressInstall: "assets/expressinstall.swf"
                });
                var queryChart = new YAHOO.widget.LineChart( "queryChart", queryData,
                {
                    xField: "TimeStamp",
                    yField: "QueryValue",
                    //		polling: pollingTime,
                    //only needed for flash player express install
                  //  expressInstall: "assets/expressinstall.swf"
                });

                var updateChart= new YAHOO.widget.LineChart( "updateChart", queryData,
                {
                    xField: "TimeStamp",
                    yField: "UpdateValue",
                    //		polling: pollingTime,
                    //only needed for flash player express install
                   // expressInstall: "assets/expressinstall.swf"
                });

                var deleteChart= new YAHOO.widget.LineChart( "deleteChart", queryData,
                {
                    xField: "TimeStamp",
                    yField: "DeleteValue",
                    //		polling: pollingTime,
                    //only needed for flash player express install
                  //  expressInstall: "assets/expressinstall.swf"
                });

                var insertChart= new YAHOO.widget.LineChart( "insertChart", queryData,
                {
                    xField: "TimeStamp",
                    yField: "InsertValue",
                    //		polling: pollingTime,
                    //only needed for flash player express install
                    //expressInstall: "assets/expressinstall.swf"
                });
     

                var myCallback = {
                    success: function(){
                        queryChart._loadDataHandler.apply(queryChart, arguments);
                        updateChart._loadDataHandler.apply(updateChart, arguments);
                        deleteChart._loadDataHandler.apply(deleteChart, arguments);
                        insertChart._loadDataHandler.apply(insertChart, arguments);
                        combinedChart._loadDataHandler.apply(combinedChart, arguments);
                        // and similar _loadDataHandler for other charts
                    },
                    failure: function() {
                        YAHOO.log("Polling failure", "error");
                    }
                }
                queryData.setInterval(pollingTime, null, myCallback) ;

            }
        </script>

        <!--END SOURCE CODE FOR EXAMPLE =============================== -->


        <!--MyBlogLog instrumentation-->
        <script type="text/javascript" src="http://track2.mybloglog.com/js/jsserv.php?mblID=2007020704011645"></script>

    </body>
</html>
